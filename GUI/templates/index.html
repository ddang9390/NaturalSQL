<head>
    <title>Natural SQL</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="container input-section">
        <h1>Natural SQL</h1>

        <form method="POST" action="/query">
            <div class="db-selection">
                <div class="db-select-group">
                    <label>Database:</label>
                    <select name="database" id='database' onchange="updateTables()">
                        {% for db in available_dbs %}
                        <option values="{{db}}">
                            {{db}}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="db-select-group">
                    <label>Table:</label>
                    <select name="table" id='table'>
                        {% for table in available_tables %}
                        <option values="{{table}}">
                            {{table}}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <label for="user_input">Enter your query in plain English:</label>
            <input type="text" placeholder="Ex. Show me the year of the movie where the name is &quot;Shrek&quot;"
                value="{{user_input}}" id="user_input" name="user_input" required>
            <button class="btn btn-primary">Submit</button>
        </form>

        <div class="help-text">
            <strong>ðŸ’¡ Tip:</strong> Use quotes for search values with multiple words<br>
            <span class="example">Example: where name is "The Dark Knight"</span>
        </div>

        <div class="example-queries">
            <h3>Try these examples:</h3>
            <ul>
                <li onclick="fillExample('show me all movies')">â€¢ Show me all movies</li>
                <li onclick="fillExample('list the names and directors of the movies')">â€¢ List the names and directors
                    of the movies
                </li>
                <li onclick="fillExample('show me movies where genre is Action')">â€¢ Show me movies where genre is
                    Action</li>
                <li onclick="fillExample('give me the year and name of movies')">â€¢ Give me the year and name of
                    movies</li>
            </ul>
        </div>
    </div>

    <div id="loading"></div>

    <div class="container">
        <div class="output-section">
            <div class="sql-query-display">
                <h3>Generated SQL Query</h3>
                <div class="sql-query-box">
                    {{query}}
                </div>
            </div>

            <div class="sql-results-display">
                {{sql_results | safe}}
            </div>
        </div>
    </div>

    <script>
        // For filling in the query box using the selected example
        function fillExample(query) {
            document.getElementById('user_input').value = query;
        }

        // For updating the table dropdown using the selected database
        function updateTables() {
            const db = document.getElementById('database').value

            fetch(`/get_tables/${db}`)
                .then(response => response.json())
                .then(data => {
                    const tableSelect = document.getElementById('table');
                    tableSelect.innerHTML = '<option></option>'

                    data.tables.forEach(table => {
                        const option = document.createElement('option');
                        option.value = table;
                        option.textContent = table;
                        tableSelect.appendChild(option);
                    });
                });
        }
    </script>
</body>